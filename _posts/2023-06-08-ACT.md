---
title: ACT
subtitle: MAST-U charge exchange diagnostics
author: Liam Pattinson
tags: MAST-U CCFE Charge Exchange
software:
    licence: UKAEA
    author: Christopher Beckley
layout: software
---

The Mega Ampere Spherical Tokamak Upgrade (MAST-U) generates a _lot_ of data. After each
'shot', the raw sensor data is made available to researchers via the Universal Data
Access (UDA) system. Each 'signal' is represented as a three letter code. For example,
'RCC' is the signal for Celeste-3, which measures the emission spectra from impurities
in the plasma. The MAST-U data processing systems include a scheduler that waits until
certain signals are available, and then begins processing raw data into more useful
diagnostics. Once completed, this processed data is itself made available via UDA as a
three letter signal code, and this may, in turn, be used to generate higher level
diagnostics via the scheduler.

ACT is the signal representing data from Charge Exchange Recombination Spectroscopy
(CXRS), which  is a technique used to measure properties such as the temperature and
density of impurity ions within a plasma. This uses raw data from the Celeste-3 camera,
which reads the emission spectra from impurities within a fixed sightline through the
plasma, as well as data from the neutral-beam injection systems. A newer signal, ACU,
represents similar data gleaned from the upgraded Celeste-4 sensors, which feature two
cameras as opposed to one, both of which are not fixed to a static sightline.

The software used to create the ACT and ACU signals is a small Python library,
confusingly also called `act`. The software is already in use and is both well
documented and quite mature. Our work on `act` was focused on improvements to the
packaging and testing systems.

Our first step was to reorganise the project to match a [Cookiecutter][cookiecutter]
project template developed by UKAEA software engineers for MAST-U scheduler codes. Many
of the MAST-U scheduler codes are still older scripts written in IDL, and the
development of this template is part of a wider push within CCFE/UKAEA to upgrade
software to modern Python. This was a relatively straightforward process, as it only
required updating the existing packaging methods to PEP 517/518/621 standards and
moving/renaming some parts of the code. This was followed by some linting, with the aim
of ensuring the project followed a consistent PEP 8 code style throughout.

Our next step was to rewrite the testing framework to make use of [pytest][pytest].
`act` provided its own testing functionality, but it required human input to run,
making it incompatible with the CCFE Gitlab CI processes.

Finally, the docstrings throughout the project were updated to [Numpy style][npstyle],
and we set up the infrastructure for creating online [Sphinx][sphinx] docs. We took this
opportunity to also introduce [type hints][typehints] throughout the project, and made
use of [`sphinx-autodoc-typehints`][autodoctypehints] to carry this typing information
into the docs. This process took much longer than expected, despite the high quality of
the existing documentation, which is something to keep in mind for any future projects!

As `act` is actively in use for tokamak experiments, the release schedule is tightly
coupled to the MAST-U experiment schedules, so we're hoping that our work can be merged
in time for the MAST-U autumn campaign.

[cookiecutter]: https://cookiecutter.readthedocs.io/en/stable/
[pytest]: https://docs.pytest.org/en/latest/
[sphinx]: https://www.sphinx-doc.org/en/master/
[npstyle]: https://numpydoc.readthedocs.io/en/latest/format.html
[sphinx]: https://www.sphinx-doc.org/en/master/
[typehints]: https://docs.python.org/3/library/typing.html
[autodoctypehints]: https://github.com/tox-dev/sphinx-autodoc-typehints
